<!DOCTYPE html>
<html lang="zh">
    <head>
    <!-- 
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.2 -->

    <!-- Title -->
    
    <title>
        
            WKWebViewTips | 
        
        Grommash
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Meta & Info -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="GuYi">
    <meta name="description" content="null">
    <meta name="keywords" content="null,Objective-C,WebView">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Grommash">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://yoursite.com">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="WKWebViewTips | Grommash">
    <meta property="og:description" content="null">
    <meta property="og:article:tag" content="Objective-C"> <meta property="og:article:tag" content="WebView"> 

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS & jQuery -->
    
        <link rel="stylesheet" href="/css/material.min.css">
        <link rel="stylesheet" href="/css/style.min.css">
        <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }
</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


        <script src="/js/jquery.min.js"></script>
        <script src="/js/queue.js"></script>
    

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    

    <!-- Bing Background -->
    

    <!-- Custom Head -->
    
</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#WKWebKit-Framework"><span class="post-toc-number">1.</span> <span class="post-toc-text">WKWebKit Framework</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Classes"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">Classes</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Protocols"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">Protocols</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#WKWebView-Tips"><span class="post-toc-number">2.</span> <span class="post-toc-text">WKWebView Tips</span></a></li></ol>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        <!-- Custom Thumbnail -->
        <div class="post_thumbnail-custom mdl-card__media mdl-color-text--grey-50" style="background-image:url(http://7xtg0o.com1.z0.glb.clouddn.com/1-7d7cjzjDQySL1lFBlLkaVw.jpeg)">
    
            <p class="article-headline-p">
                WKWebViewTips
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/grommash_avatar.jpeg" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>GuYi</strong>
        <span>2月 04, 2016</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/Objective-C/">Objective-C</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/WebView/">WebView</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    

    <!-- Share Twitter -->
    

    <!-- Share Facebook -->
    

    <!-- Share Google+ -->
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>WKWebView是现代WebKit API在iOS8和OS X Yosemite应用中的核心部分。它代替了UIKit中的UIWebView和AppKit中的WebView，提供了统一的跨双平台API。他自诩拥有60fps滚动刷新率、内置手势、高效的app和web信息交换通道、和Safari相同的JavaScript引擎，而其将UIWebViewDelegate与UIWebView重构成了14类与3个协议</p>
<p>本文记录了一些WKWebView使用的相关注意事项</p>
<a id="more"></a>
<h1 id="WKWebKit-Framework"><a href="#WKWebKit-Framework" class="headerlink" title="WKWebKit Framework"></a>WKWebKit Framework</h1><h2 id="Classes"><a href="#Classes" class="headerlink" title="Classes"></a>Classes</h2><ul>
<li>WKBackForwardList: 之前访问过的web页面的列表，可以通过后退和前进动作来访问到。</li>
<li>WKBackForwardListItem: webview中后退列表里的某一个网页。</li>
<li>WKFrameInfo: 包含一个网页的布局信息。</li>
<li>WKNavigation: 包含一个网页的加载进度信息。</li>
<li>WKNavigationAction: 包含可能让网页导航变化的信息，用于判断是否做出导航变化。</li>
<li>WKNavigationResponse: 包含可能让网页导航变化的返回内容信息，用于判断是否做出导航变化。</li>
<li>WKPreferences: 概括一个webview的偏好设置。</li>
<li>WKProcessPool: 表示一个web内容加载池。</li>
<li>WKUserContentController: 提供使用JavaScript post信息和注射script的方法。</li>
<li>WKScriptMessage: 包含网页发出的信息。</li>
<li>WKUserScript: 表示可以被网页接受的用户脚本。</li>
<li>WKWebViewConfiguration: 初始化webview的设置。</li>
<li>WKWindowFeatures: 指定加载新网页时的窗口属性。</li>
</ul>
<h2 id="Protocols"><a href="#Protocols" class="headerlink" title="Protocols"></a>Protocols</h2><ul>
<li>WKNavigationDelegate: 提供了追踪主窗口网页加载过程和判断主窗口和子窗口是否进行页面加载新页面的相关方法。</li>
<li>WKScriptMessageHandler: 提供从网页中收消息的回调方法。</li>
<li>WKUIDelegate: 提供用原生控件显示网页的方法回调。<br>这里有篇很好的文章介绍了UIWebViewDelegate与UIWebView的API区别和JS与Swift的对话机制<a href="http://nshipster.cn/wkwebkit/" target="_blank" rel="external">http://nshipster.cn/wkwebkit/</a>。</li>
</ul>
<h1 id="WKWebView-Tips"><a href="#WKWebView-Tips" class="headerlink" title="WKWebView Tips"></a>WKWebView Tips</h1><ul>
<li><code>file:///</code>无法在tmp目录中工作，只能用<code>file:</code>访问tmp目录。<br><a href="https://github.com/shazron/WKWebViewFIleUrlTest" target="_blank" rel="external">https://github.com/shazron/WKWebViewFIleUrlTest</a>有具体例子</li>
<li>不能在Storyboard或者Interface Builder中创建。</li>
<li><code>HTML &lt;a&gt; tag</code>带着<code>target=&quot;_blank&quot;</code>不会响应。</li>
<li><p>URL Scheme和 AppStore links无法使用</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">/* Using [bendytree/Objective-C-RegEx-Categories](https://github.com/bendytree/Objective-C-RegEx-Categories) to check URL String */</span></div><div class="line"><span class="meta">#import <span class="meta-string">"RegExCategories.h"</span></span></div><div class="line">- (<span class="keyword">void</span>)webView:(<span class="built_in">WKWebView</span> *)webView decidePolicyForNavigationAction:(<span class="built_in">WKNavigationAction</span> *)navigationAction decisionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">WKNavigationActionPolicy</span>))decisionHandler &#123;</div><div class="line">    <span class="built_in">NSURL</span> *url = navigationAction.request.URL;</div><div class="line">    <span class="built_in">NSString</span> *urlString = (url) ? url.absoluteString : <span class="string">@""</span>;</div><div class="line"></div><div class="line">    <span class="comment">/* iTunes: App Store link */</span></div><div class="line">    <span class="keyword">if</span> ([urlString isMatch:RX(<span class="string">@"\\/\\/itunes\\.apple\\.com\\/"</span>)]) &#123;</div><div class="line">        [[<span class="built_in">UIApplication</span> sharedApplication] openURL:url];</div><div class="line">        decisionHandler(<span class="built_in">WKNavigationActionPolicyCancel</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/* Protocol/URL-Scheme without http(s) */</span></div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (![urlString isMatch:[<span class="string">@"^https?:\\/\\/."</span> toRxIgnoreCase:<span class="literal">YES</span>]]) &#123;</div><div class="line">        [[<span class="built_in">UIApplication</span> sharedApplication] openURL:url];</div><div class="line">        decisionHandler(<span class="built_in">WKNavigationActionPolicyCancel</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    decisionHandler(<span class="built_in">WKNavigationActionPolicyAllow</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>JS的alert, confirm, prompt需要调用WKUIDelegate方法<br>如果你想要展示对话框，你需要执行以下方法</p>
</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">webView:runJavaScriptAlertPanelWithMessage:initiatedByFrame:completionHandler:</div><div class="line">webView:runJavaScriptConfirmPanelWithMessage:initiatedByFrame:completionHandler:</div><div class="line">webView:runJavaScriptTextInputPanelWithPrompt:defaultText:initiatedByFrame:completionHandler:</div></pre></td></tr></table></figure>
<p><a href="http://qiita.com/ShingoFukuyama/items/5d97e6c62e3813d1ae98" target="_blank" rel="external">这里有设置方法</a></p>
<ul>
<li><code>Basic/Digest/etc</code>验证输入对话框需要调用WKNavigationDelegate方法<code>webView:didReceiveAuthenticationChallenge:completionHandler:</code></li>
</ul>
<p>例子：</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)webView:(<span class="built_in">WKWebView</span> *)webView didReceiveAuthenticationChallenge:(<span class="built_in">NSURLAuthenticationChallenge</span> *)challenge completionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSURLSessionAuthChallengeDisposition</span>, <span class="built_in">NSURLCredential</span> *))completionHandler &#123;</div><div class="line"></div><div class="line">    <span class="built_in">NSString</span> *hostName = webView.URL.host;</div><div class="line">    <span class="built_in">NSString</span> *authenticationMethod = [[challenge protectionSpace] authenticationMethod];</div><div class="line"></div><div class="line">    <span class="keyword">if</span> ([authenticationMethod isEqualToString:<span class="built_in">NSURLAuthenticationMethodDefault</span>]</div><div class="line">    || [authenticationMethod isEqualToString:<span class="built_in">NSURLAuthenticationMethodHTTPBasic</span>]</div><div class="line">    || [authenticationMethod isEqualToString:<span class="built_in">NSURLAuthenticationMethodHTTPDigest</span>]) &#123;</div><div class="line">        <span class="built_in">NSString</span> *title = <span class="string">@"Authentication Challenge"</span>;</div><div class="line">        <span class="built_in">NSString</span> *message = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@ requires user name and password"</span>, hostName];</div><div class="line">        <span class="built_in">UIAlertController</span> *alertController = [<span class="built_in">UIAlertController</span> alertControllerWithTitle:title message:message preferredStyle:<span class="built_in">UIAlertControllerStyleAlert</span>];</div><div class="line">        [alertController addTextFieldWithConfigurationHandler:^(<span class="built_in">UITextField</span> *textField) &#123;</div><div class="line">            textField.placeholder = <span class="string">@"User"</span>;</div><div class="line">            <span class="comment">/* textField.secureTextEntry = YES; */</span></div><div class="line">        &#125;];</div><div class="line">        [alertController addTextFieldWithConfigurationHandler:^(<span class="built_in">UITextField</span> *textField) &#123;</div><div class="line">            textField.placeholder = <span class="string">@"Password"</span>;</div><div class="line">            textField.secureTextEntry = <span class="literal">YES</span>;</div><div class="line">        &#125;];</div><div class="line">        [alertController addAction:[<span class="built_in">UIAlertAction</span> actionWithTitle:<span class="string">@"OK"</span> style:<span class="built_in">UIAlertActionStyleDefault</span> handler:^(<span class="built_in">UIAlertAction</span> *action) &#123;</div><div class="line">            <span class="built_in">NSString</span> *userName = ((<span class="built_in">UITextField</span> *)alertController.textFields[<span class="number">0</span>]).text;</div><div class="line">            <span class="built_in">NSString</span> *password = ((<span class="built_in">UITextField</span> *)alertController.textFields[<span class="number">1</span>]).text;</div><div class="line">            <span class="built_in">NSURLCredential</span> *credential = [[<span class="built_in">NSURLCredential</span> alloc] initWithUser:userName password:password persistence:<span class="built_in">NSURLCredentialPersistenceNone</span>];</div><div class="line">            completionHandler(<span class="built_in">NSURLSessionAuthChallengeUseCredential</span>, credential);</div><div class="line">        &#125;]];</div><div class="line">        [alertController addAction:[<span class="built_in">UIAlertAction</span> actionWithTitle:<span class="string">@"Cancel"</span> style:<span class="built_in">UIAlertActionStyleCancel</span> handler:^(<span class="built_in">UIAlertAction</span> *action) &#123;</div><div class="line">            completionHandler(<span class="built_in">NSURLSessionAuthChallengeCancelAuthenticationChallenge</span>, <span class="literal">nil</span>);</div><div class="line">        &#125;]];</div><div class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">            [<span class="keyword">self</span> presentViewController:alertController animated:<span class="literal">YES</span> completion:^&#123;&#125;];</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ([authenticationMethod isEqualToString:<span class="built_in">NSURLAuthenticationMethodServerTrust</span>]) &#123;</div><div class="line">        <span class="comment">/* needs this handling on iOS 9 */</span></div><div class="line">        completionHandler(<span class="built_in">NSURLSessionAuthChallengePerformDefaultHandling</span>, <span class="literal">nil</span>);</div><div class="line">        <span class="comment">/* or, see also http://qiita.com/niwatako/items/9ae602cb173625b4530a#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89 */</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        completionHandler(<span class="built_in">NSURLSessionAuthChallengeCancelAuthenticationChallenge</span>, <span class="literal">nil</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>多个WKWebView之间的cookie传递<br>使用WKProcessPool在webviews之间进行cookie传递</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="keyword">self</span>.processPool = [[<span class="built_in">WKProcessPool</span> alloc] init];</div><div class="line"><span class="built_in">WKWebViewConfiguration</span> *configuration1 = [[<span class="built_in">WKWebViewConfiguration</span> alloc] init];</div><div class="line">configuration1.processPool = <span class="keyword">self</span>.processPool;</div><div class="line"><span class="built_in">WKWebView</span> *webView1 = [[<span class="built_in">WKWebView</span> alloc] initWithFrame:<span class="built_in">CGRectZero</span> configuration:configuration1];</div><div class="line">...</div><div class="line"><span class="built_in">WKWebViewConfiguration</span> *configuration2 = [[<span class="built_in">WKWebViewConfiguration</span> alloc] init];</div><div class="line">configuration2.processPool = <span class="keyword">self</span>.processPool;</div><div class="line"><span class="built_in">WKWebView</span> *webView2 = [[<span class="built_in">WKWebView</span> alloc] initWithFrame:<span class="built_in">CGRectZero</span> configuration:configuration2];</div><div class="line">...</div></pre></td></tr></table></figure>
<ul>
<li>无法使用NSURLProtocol, NSCachedURLResponse,NSURLProtocol<br>UIWebView可以通过NSURLProtocol, NSCachedURLResponse,NSURLProtocol过滤广告网站和缓存和离线浏览，但是WKWebView不能。</li>
<li><p>Cookie, Cache, Credential, WebKit data不容易被清除<br>iOS8<br>1.和UIWebView一样的方法用使用NSURLCache和NSHTTPCookie来删除cookies和caches。<br>2.如果你使用WKProccessPool对它重新初始化。<br>3.在Library目录中删除Cookies, Caches及WebKit的子目录。<br>4.删除所有WKWebViews。<br>iOS9</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="comment">/* Optional data */</span></div><div class="line"><span class="built_in">NSSet</span> *websiteDataTypes = [<span class="built_in">NSSet</span> setWithArray:@[</div><div class="line">    <span class="built_in">WKWebsiteDataTypeDiskCache</span>,</div><div class="line">    <span class="built_in">WKWebsiteDataTypeOfflineWebApplicationCache</span>,</div><div class="line">    <span class="built_in">WKWebsiteDataTypeMemoryCache</span>,</div><div class="line">    <span class="built_in">WKWebsiteDataTypeLocalStorage</span>,</div><div class="line">    <span class="built_in">WKWebsiteDataTypeCookies</span>,</div><div class="line">    <span class="built_in">WKWebsiteDataTypeSessionStorage</span>,</div><div class="line">    <span class="built_in">WKWebsiteDataTypeIndexedDBDatabases</span>,</div><div class="line">    <span class="built_in">WKWebsiteDataTypeWebSQLDatabases</span></div><div class="line">]];</div><div class="line"></div><div class="line"><span class="comment">/* All kinds of data */</span></div><div class="line"><span class="built_in">NSSet</span> *websiteDataTypes = [<span class="built_in">WKWebsiteDataStore</span> allWebsiteDataTypes];</div><div class="line"><span class="comment">/* Date from */</span></div><div class="line"><span class="built_in">NSDate</span> *dateFrom = [<span class="built_in">NSDate</span> dateWithTimeIntervalSince1970:<span class="number">0</span>];</div><div class="line"><span class="comment">/* Execute */</span></div><div class="line">[[<span class="built_in">WKWebsiteDataStore</span> defaultDataStore] removeDataOfTypes:websiteDataTypes modifiedSince:dateFrom completionHandler:^&#123;</div><div class="line">    <span class="comment">/* Done */</span></div><div class="line">&#125;];</div></pre></td></tr></table></figure>
</li>
<li><p>iOS9上滚动速度bug<br>在iOS 8以下代码没问题,它可以用更多的惯性滚动。</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">webView.scrollView.decelerationRate = <span class="built_in">UIScrollViewDecelerationRateNormal</span>;</div></pre></td></tr></table></figure>
<p>  至于iOS 9，没有在UIScrollView代理中设置滚动速度，这段代码是没有意义的。<br>  ​<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)scrollViewWillBeginDragging:(<span class="built_in">UIScrollView</span> *)scrollView &#123;</div><div class="line">    scrollView.decelerationRate = <span class="built_in">UIScrollViewDecelerationRateNormal</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</li>
<li><p>不能禁用长按链接菜单<br>CSS: <code>-webkit-touch-callout: none;</code>和JavaScript: <code>document.documentElement.style.webkitTouchCallout=&#39;none&#39;;</code>无法使用。<br>iOS8.2之后修复了这个bug。</p>
</li>
<li>有时候捕捉WKWebView失败<br>有时捕捉截图WKWebView本身失败,试图捕捉WKWebView的scrollView属性。不然使用私有API，使用<a href="https://github.com/lemonmojo/WKWebView-Screenshot" target="_blank" rel="external">https://github.com/lemonmojo/WKWebView-Screenshot</a>。</li>
<li>Xcode6.1及以上不能精确的说明WKWebView使用的内存</li>
<li>window.webkit.messageHandlers在有些站点无法使用<br>一些网站一定程度上重载了JS的window.webkit，为了避免这个问题,你应该在一个网站的内容开始加载之前缓存这个变量。<code>WKUserScriptInjectionTimeAtDocumentStart</code>可以帮助你。</li>
<li>cookie有时候无法保存<br>WKWebView初始化时,它可以设置cookie管理地区而不等待这个区域被同步。</li>
<li>WKWebView的backForwardList属性是只读的。</li>
<li>很难和UIWebView在iOS7及以下共存。<br>参考翻译自<a href="https://github.com/ShingoFukuyama/WKWebViewTips" target="_blank" rel="external">https://github.com/ShingoFukuyama/WKWebViewTips</a></li>
</ul>
<p>```</p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    







                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2016/03/23/thread-lock/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2015/12/28/runtime-6/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/grommash_avatar.jpeg" alt="GuYi's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        guxinqi25@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">十二月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">十一月 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">十月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">九月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/04/">四月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/03/">三月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/02/">二月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/12/">十二月 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/11/">十一月 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/09/">九月 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/08/">八月 2015<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/07/">七月 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/06/">六月 2015<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/技术/">技术<span class="sidebar_archives-count">18</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/about" title="关于">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                关于
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;Grommash
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->

    <script src="/js/lazyload.min.js"></script>
    <script src="/js/js.min.js"></script>



    <script src="/js/nprogress.js"></script>


<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>














<!-- Swiftye -->


<!-- Local Search-->


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->


                </main>
            </div>
        </body>
    
</html>
